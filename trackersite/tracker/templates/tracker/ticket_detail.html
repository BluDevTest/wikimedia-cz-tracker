{% extends "base.html" %}
{% load i18n adminmedia %}
{% load comments %}

{% block head %}{{ block.super }}
<script src="{% admin_media_prefix %}js/jquery.min.js" type="text/javascript"></script>
<script src="{{STATIC_URL}}hiding.js" type="text/javascript"></script>
{% endblock %}

{% block title %}{{ ticket.summary }}{% endblock %}

{% block content %}
<p class="nav"><a href="{% url ticket_list %}">{% trans "index" %}</a> &gt; <a href="{% url topic_list %}">{% trans "topics" %}</a> &gt; <a href="{% url topic_detail ticket.topic.id %}">{{ticket.topic}}</a> &gt;</p>
<h1>{{ ticket.summary }}</h1>
{% if user_can_edit_ticket %}<p><a href="{% url edit_ticket ticket.id %}">{% trans "edit ticket" %}</a></p>{% endif %}
<p>{% trans "Ticket ID" %}: {{ ticket.id }}<br />
{% trans "Created" %}: {{ ticket.created }}<br />
{% trans "Last changed" %}: {{ ticket.updated }}<br />
{% trans "Event date" %}: {{ ticket.event_date|default_if_none:_("unset") }}<br />
{% trans "Requested by" %}: {{ ticket.requested_by_html }}<br />
{% trans "Topic" %}: {{ ticket.topic }}<br />
{% trans "State" %}: {{ ticket.state_str }}</p>

{% if ticket.description %}<div>{{ ticket.description|safe|linebreaks }}</div>{% endif %}

{% if ticket.supervisor_notes %}<h2>{% trans "Supervisor notes" %}</h2><div>{{ ticket.supervisor_notes|safe|linebreaks }}</div>{% endif %}

{% if ticket.media_count.objects > 0 %}
<h2>{% trans "Media" %}</h2>
<p>{% trans "Number of objects" %}: {{ ticket.media_count.objects }}
{% if ticket.media_count.media %}<br />{% trans "Number of media files" %}: {{ ticket.media_count.media }}</p>{% endif %}
<ul>
{% for item in ticket.mediainfo_set.all %}
<li>{% if item.url %}<a href="{{item.url}}">{{item.description}}</a>{% else %}{{item.description}}{% endif %}{% if item.count %} ({{item.count}}){% endif %}</li>
{% endfor %}
</ul>
{% endif %}

{% if ticket.expeditures.count > 0 %}
<h2>{% trans "Expeditures" %}</h2>
<table>
<tr><th>{% trans "Item" %}</th><th>{% trans "Amount" %} ({{ticket.currency}})</th><th>{% trans "Accounting info" %}</tr>
{% for item in ticket.expediture_set.all %}
<tr><td>{{item.description}}</td><td class="money">{{item.amount}}</td><td>{{item.accounting_info}}</td></tr>
{% endfor %}
<tr class="total first_total"><td>{% trans "Total expeditures" %}</td><td class="money">{{ticket.expeditures.amount}}</td><td></td></tr>
<tr class="total"><td>{% trans "Accepted expeditures" %}</td><td class="money">{{ticket.accepted_expeditures}}</td><td></td></tr>
</table>
{% endif %}

{% get_comment_count for ticket as comment_count %}
{% if comment_count %}
<h2>{% trans "Comments" %} ({{comment_count}})</h2>
{% render_comment_list for ticket %}
{% else %}
<h2>{% trans "Comments" %}</h2>
<p>{% trans "There are no comments yet." %}</p>
{% endif %}

<div class="hide-switch"><a href="#" class="unhide">{% trans "Add comment" %}</a>
<div class="hidden">
<h3>{% trans "Add comment" %}</h3>
{% url ticket_detail pk=ticket.id as next %}{% render_comment_form for ticket %}
</div></div>

{% endblock content %}