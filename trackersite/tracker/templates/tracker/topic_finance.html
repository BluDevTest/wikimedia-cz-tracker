{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Topic finance" %}{% endblock %}

{% block content %}
<p class="nav"><a href="{% url ticket_list %}">{% trans "index" %}</a> &gt; <a href="{% url topic_list %}">{% trans "topics" %}</a> &gt;</p>
<h1>{% trans "Topic finance" %}</h1>
<table><tr>
<th rowspan="2">{% trans "Topic" %}</th>
<th rowspan="2"><abbr title="{% trans "Grant" %}">{% filter slice:":2" %}{% trans "Grant" %}{% endfilter %}<abbr></th>
<th rowspan="2">{% trans "Tickets" %}</th>
<th colspan="3" class="smaller">{% trans "Amounts per payment status" %}</th>
{% if have_fuzzy %}<th rowspan="2"></td>{% endif %}
</tr>
<th>{% trans "unpaid" %}</th>
<th>{% trans "paid" %}</th>
<th>{% trans "overpaid" %}</th>
</tr>
{% for item in topic_sums %}
<tr>
<td><a href="{% url topic_detail item.topic.id %}">{{item.topic.name}}</a></td>
<td><a href="{{item.topic.grant.get_absolute_url}}" title="{{topic.grant.full_name}}">{{item.topic.grant.short_name}}</a></td>
<td>{{item.topic.ticket_set.count}}</td>
<td class="money payment_cell {% if item.finance.unpaid %}unpaid{% else %}n_a{% endif %}">{{item.finance.unpaid}}&nbsp;{{CURRENCY}}</td>
<td class="money payment_cell{% if item.finance.paid %} paid{% endif %}">{{item.finance.paid}}&nbsp;{{CURRENCY}}</td>
<td class="money payment_cell {% if item.finance.overpaid %}overpaid{% else %}n_a{% endif %}">{{item.finance.overpaid}}&nbsp;{{CURRENCY}}</td>
{% if have_fuzzy %}<td>{% if item.finance.fuzzy %}✱{% endif %}</td>{% endif %}
</tr>
{% endfor %}
<tr class="total first_total">
	<td colspan="2">{% trans "Total" %}</td>
	<td></td>
	<td class="money payment_cell{% if cluster_sums.unpaid %} unpaid{% endif %}">{{cluster_sums.unpaid}}&nbsp;{{CURRENCY}}</td>
	<td class="money payment_cell{% if cluster_sums.paid %} paid{% endif %}">{{cluster_sums.paid}}&nbsp;{{CURRENCY}}</td>
	<td class="money payment_cell{% if cluster_sums.overpaid %} overpaid{% endif %}">{{cluster_sums.overpaid}}&nbsp;{{CURRENCY}}</td>
	{% if have_fuzzy %}<td></td>{% endif %}
</tr>
</table>

{% if have_fuzzy %}<p>
✱ {% blocktrans %}Marked topics involve partial payments that have no clear relation to topic, and have been split equally among possible candidates.{% endblocktrans %}
</p>{% endif %}

{% endblock content %}
