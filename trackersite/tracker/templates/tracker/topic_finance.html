{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Topic finance" %}{% endblock %}

{% block content %}
<p class="nav"><a href="{% url ticket_list %}">{% trans "index" %}</a> &gt; <a href="{% url topic_list %}">{% trans "topics" %}</a> &gt;</p>
<h1>{% trans "Topic finance" %}</h1>
<table><tr>
<th rowspan="2">{% trans "Topic" %}</th>
<th rowspan="2"><abbr title="{% trans "Grant" %}">{% filter slice:":2" %}{% trans "Grant" %}{% endfilter %}<abbr></th>
<th rowspan="2">{% trans "Tickets" %}</th>
<th colspan="3" class="smaller">{% trans "Amounts per payment status" %}</th>
{% if have_fuzzy %}<th rowspan="2"></td>{% endif %}
</tr>
<th>{% trans "unpaid" %}</th>
<th>{% trans "paid" %}</th>
<th>{% trans "overpaid" %}</th>
</tr>
{% for item in topic_sums %}
<tr>
<td><a href="{% url topic_detail item.topic.id %}">{{item.topic.name}}</a></td>
<td><a href="{{item.topic.grant.get_absolute_url}}" title="{{topic.grant.full_name}}">{{item.topic.grant.short_name}}</a></td>
<td>{{item.topic.ticket_set.count}}</td>
<td{% if item.finance.unpaid %} class="payment_cell unpaid"{% endif %}>{{item.finance.unpaid}}</td>
<td{% if item.finance.paid %} class="payment_cell paid"{% endif %}>{{item.finance.paid}}</td>
<td{% if item.finance.overpaid %} class="payment_cell overpaid"{% endif %}>{{item.finance.overpaid}}</td>
{% if have_fuzzy %}<td>{% if item.finance.fuzzy %}✱{% endif %}</td>{% endif %}
</tr>
{% endfor %}
<tr class="total first_total">
	<td colspan="2">{% trans "Total" %}</td>
	<td></td>
	<td{% if cluster_sums.unpaid %} class="payment_cell unpaid"{% endif %}>{{cluster_sums.unpaid}}</td>
	<td{% if cluster_sums.paid %} class="payment_cell paid"{% endif %}>{{cluster_sums.paid}}</td>
	<td{% if cluster_sums.overpaid %} class="payment_cell overpaid"{% endif %}>{{cluster_sums.overpaid}}</td>
	{% if have_fuzzy %}<td></td>{% endif %}
</tr>
</table>

{% if have_fuzzy %}<p>
✱ {% blocktrans %}Payment sums for marked topics may not be accurate, as they involve partial payments assigned to more than one ticket. Such payments may be counted multiple times in per-topic row. Total sums are not affected.{% endblocktrans %}
</p>{% endif %}

{% endblock content %}
